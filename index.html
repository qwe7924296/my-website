<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>

<div id="app">
  <video id="qr-reader" width="500" height="500" autoplay playsinline></video>
  <button @click="startScanning">Start Scanning</button>
  <p>Scanned Value: {{ scannedValue }}</p>
</div>

<script>
  new Vue({
    el: "#app",
    data: {
      scannedValue: "",
      qrCodeScanner: null // 將 qrCodeScanner 存儲為 Vue 實例的一部分
    },
    methods: {
      startScanning: function () {
        if (!this.qrCodeScanner) {
          this.qrCodeScanner = new Html5Qrcode("qr-reader");
        }
        
        this.qrCodeScanner.start(
          { facingMode: "environment" }, // 使用後置相機
          (decodedText, decodedResult) => {
            this.scannedValue = decodedText;
            this.qrCodeScanner.stop(); // 掃描到後停止掃描
          },
          (errorMessage) => {
            console.error(errorMessage);
          }
        );
      },
    },
    beforeDestroy: function() {
      if (this.qrCodeScanner) {
        this.qrCodeScanner.stop();
      }
    }
  });
</script>

<!-- Vue 3 CDN -->
<script src="https://unpkg.com/vue@next"></script>
<!-- ZXing Library for QR Code scanning -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<div id="app">
  <video id="qr-reader" width="500" height="500" autoplay playsinline></video>
  <button @click="startScanning">Start Scanning</button>
  <p>Scanned Value: {{ scannedValue }}</p>
</div>

<script>
const { ref, onMounted, onUnmounted } = Vue;

const app = Vue.createApp({
  setup() {
    const scannedValue = ref("");
    let codeReader = new ZXing.BrowserMultiFormatReader();

    async function startScanning() {
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const rearCamera = devices.find(device => device.kind === 'videoinput' && /back|rear/i.test(device.label));
        const cameraId = rearCamera ? rearCamera.deviceId : undefined;

        codeReader.decodeFromVideoDevice(cameraId, 'qr-reader', (result, err) => {
          if (result) {
            scannedValue.value = result.text;
            codeReader.reset();
          }
        });
      } catch (error) {
        console.error("Error initializing camera", error);
      }
    }

    onUnmounted(() => {
      codeReader.reset();
    });

    return {
      scannedValue,
      startScanning
    };
  }
});

app.mount("#app");
</script>
